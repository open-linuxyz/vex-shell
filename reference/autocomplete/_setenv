#compdef setenv

_setenv() {
  local state
  local -a args

  args=(
      '1: :->first_arg'
  )

  _arguments -C $args

  case "$state" in
      first_arg)
          local -a first_args
          first_args=(
              '-n:Create a new environment'
              '--new:Create a new environment'
              '-z:Reset the current environment'
              '-h:Show help message'
              '--help:Show help message'
          )

          # Add existing environment names to the first_args array
          for env_file in "${CMD_SETENV_DIR}"/*; do
              env_name="$(basename "$env_file")"
              first_args+=("$env_name:Load environment $env_name")
          done

          _describe 'setenv command' first_args
          ;;
  esac
}

compdef _setenv setenv
